import{c}from"./chunk-BNAEO53W.js";import{c as m,f as g,g as f,h as o,i as v,n,o as u}from"./chunk-C4IYMCUQ.js";import{V as h,_ as r,d as s,l as d,la as i}from"./chunk-CIOIUQ7L.js";var p=class a{auth=r(m);firestore=r(v);router=r(c);currentUser=i(null);isAdmin=i(!1);errorMessage=i(null);authStateResolved=new d(1);user$=this.authStateResolved.asObservable();constructor(){g(this.auth,e=>s(this,null,function*(){if(this.currentUser.set(e),e){let t=yield u(n(this.firestore,"users",e.uid));this.isAdmin.set(t.exists()&&t.data().role==="admin")}else this.isAdmin.set(!1);this.authStateResolved.next(e)}))}isAuthenticated(){return!!this.currentUser()}login(e,t){return s(this,null,function*(){this.errorMessage.set(null);try{let b=(yield f(this.auth,e,t)).user,l=yield u(n(this.firestore,"users",b.uid));l.exists()&&l.data().role==="admin"?(this.isAdmin.set(!0),this.router.navigate(["/admin"])):(this.isAdmin.set(!1),yield o(this.auth),this.errorMessage.set("You do not have permission to access the admin panel."),this.router.navigate(["/admin/login"]))}catch{this.errorMessage.set("Invalid email or password. Please try again.")}})}logout(){return s(this,null,function*(){yield o(this.auth),this.router.navigate(["/admin/login"])})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})};export{p as a};
